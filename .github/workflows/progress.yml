name: Auto Track GSoC Progress

on:
  push:
    paths:
      - "weekly-logs/**"
      - "CONTRIBUTIONS.md"

jobs:
  track-progress:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Calculate progress metrics
        run: |
          DONE=$(grep -R "\[x\]" weekly-logs | wc -l || echo 0)
          TOTAL=$(grep -R "\[ \]" weekly-logs | wc -l || echo 0)
          PRS=$(grep -R "^- PR:" CONTRIBUTIONS.md | wc -l || echo 0)

          COMPLETION=0
          if [ $((DONE + TOTAL)) -gt 0 ]; then
            COMPLETION=$((DONE * 100 / (DONE + TOTAL)))
          fi

          cat <<EOF > progress.json
          {
            "tasks_completed": $DONE,
            "tasks_remaining": $TOTAL,
            "completion_percent": $COMPLETION,
            "pull_requests": $PRS
          }
          EOF

          echo "Generated progress.json"
          cat progress.json

      - name: Commit progress.json
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add progress.json
          git commit -m "chore: auto-update progress metrics" || exit 0
          git push
